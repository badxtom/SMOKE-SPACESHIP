<!DOCTYPE html>
<html lang="es">


<head>
  <title>Configuración</title>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="Luz Collado" content="codedthemes">


  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
    id="main-font-link">

  <link rel="stylesheet" href="tabler-icons.min.css">

  <link rel="stylesheet" href="feather.css">

  <link rel="stylesheet" href="fontawesome.css">

  <link rel="stylesheet" href="material.css">

  <link rel="stylesheet" href="style.css" id="main-style-link">
  <link rel="stylesheet" href="style-preset.css">

  <style>
    .text-dark-blue {
      color: darkblue;
    }

    .btn-dark-blue {
      background-color: darkblue;
      color: white;
      border: none;
      transition: background-color 0.3s ease;

    }

    .btn-dark-blue:hover {
      background-color: navy;

    }
  </style>
</head>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const userCreds = sessionStorage.getItem("user-creds");
    if (!userCreds && window.location.pathname.includes('settings')) {
      window.location.href = 'login';
    }

  });
</script>

<body data-pc-preset="preset-1" data-pc-sidebar-theme="light" data-pc-sidebar-caption="true" data-pc-direction="ltr"
  data-pc-theme="light">

  <div class="loader-bg">
    <div class="loader-track">
      <div class="loader-fill"></div>
    </div>
  </div>

  <nav class="pc-sidebar">
    <div class="navbar-wrapper">
      <div class="m-header">
        <a href="home" class="b-brand text-primary">
          <img src="logo spaceship-modified.png" style="width: 90px; height: 90px; border-radius: 5px;" alt="...">
        </a>
      </div>

      <div class="navbar-content">
        <ul class="pc-navbar">
          <li class="pc-item pc-caption">
            <label>Dashboard</label>
            <i class="ti ti-dashboard"></i>
          </li>
          <li class="pc-item">
            <a href="home" class="pc-link">
              <span class="pc-micon"><i class="ti ti-dashboard"></i></span>
              <span class="pc-mtext">Sistema</span>
            </a>
          </li>
          <li class="pc-item pc-caption">
            <label>Empresa</label>
            <i class="ti ti-dashboard"></i>
          </li>
          <li class="pc-item">
            <a href="info" class="pc-link">
              <span class="pc-micon"><i class="ti ti-clipboard-list"></i></span>
              <span class="pc-mtext">Datos</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <header class="pc-header">
    <div class="header-wrapper">

      <div class="ms-auto">
        <ul class="list-unstyled">
          <li class="pc-h-item header-mobile-collapse">
            <a href="#" class="pc-head-link head-link-secondary ms-0" id="sidebar-hide">
              <i class="ti ti-menu-2"></i>
            </a>
          </li>
          <li class="pc-h-item pc-sidebar-popup">
            <a href="#" class="pc-head-link head-link-secondary ms-0" id="mobile-collapse">
              <i class="ti ti-menu-2"></i>
            </a>
          </li>
          <!-- <li class="dropdown pc-h-item">
            <a class="pc-head-link head-link-secondary dropdown-toggle arrow-none me-0" data-bs-toggle="dropdown"
              href="#" role="button" aria-haspopup="false" aria-expanded="false">
              <i class="ti ti-bell"></i>
            </a>
            <div class="dropdown-menu dropdown-notification dropdown-menu-end pc-h-dropdown">
              <div class="dropdown-header">
                <a href="#!" class="link-primary float-end text-decoration-underline">Mark as all read</a>
                <h5>All Notification <span class="badge bg-warning rounded-pill ms-1">01</span></h5>
              </div>
              <div class="dropdown-header px-0 text-wrap header-notification-scroll position-relative"
                style="max-height: calc(100vh - 215px)">
                <div class="list-group list-group-flush w-100">
                  <div class="list-group-item list-group-item-action">
                    <div class="d-flex">
                      <div class="flex-shrink-0">
                        <div class="user-avtar bg-light-success"><i class="ti ti-building-store"></i></div>
                      </div>
                      <div class="flex-grow-1 ms-1">
                        <span class="float-end text-muted">3 min ago</span>
                        <h5>Store Verification Done</h5>
                        <p class="text-body fs-6">We have successfully received your request.</p>
                        <div class="badge rounded-pill bg-light-danger">Unread</div>
                      </div>
                    </div>
                  </div>
                  <div class="list-group-item list-group-item-action">
                    <div class="d-flex">
                      <div class="flex-shrink-0">
                        <img src="../assets/images/user/avatar-3.jpg" alt="user-image" class="user-avtar">
                      </div>
                      <div class="flex-grow-1 ms-1">
                        <span class="float-end text-muted">10 min ago</span>
                        <h5>Joseph William</h5>
                        <p class="text-body fs-6">It is a long established fact that a reader will be distracted </p>
                        <div class="badge rounded-pill bg-light-success">Confirmation of Account</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="dropdown-divider"></div>
              <div class="text-center py-2">
                <a href="#!" class="link-primary">Mark as all read</a>
              </div>
            </div>
          </li> -->
          <li class="dropdown pc-h-item header-user-profile">
            <a class="pc-head-link head-link-primary dropdown-toggle arrow-none me-0" data-bs-toggle="dropdown" href="#"
              role="button" aria-haspopup="false" aria-expanded="false">
              <img src="logo spaceship-modified.png" style="width: 50px; height: 50px; border-radius: 50%;" />
              <span>
                <i class="ti ti-settings"></i>
              </span>
            </a>
            <div class="dropdown-menu dropdown-user-profile dropdown-menu-end pc-h-dropdown">
              <div class="dropdown-header">
                <h4>Hola, <span class="small text-muted" id="username"> Name</span></h4>
                <p class="text-muted" id="role">Rol</p>
                <hr>
                <div class="profile-notification-scroll position-relative" style="max-height: calc(100vh - 280px)">
                  <hr>
                  <button id="settingsButton" type="submit" class="dropdown-item">
                    <i class="ti ti-settings"></i>
                    <span>Configuración</span>
                  </button>
                  <button id="registerButton" type="submit" class="dropdown-item">
                    <i class="ti ti-user-plus"></i>
                    <span>Registro</span>
                  </button>
                  <button class="dropdown-item" id="signoutbutton">
                    <i class="ti ti-logout"></i>
                    <span>Cerrar Sesión</span>
                  </button>

                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </header>

  <div class="pc-container">
    <div class="pc-content">

      <div class="row">
        <div class="col">
          <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="home">Sistema</a></li>
            <li class="breadcrumb-item" aria-current="page">Configuración</li>
          </ul>
        </div>
      </div>

      <div class="row">

        <div class="col-sm-12">
          <div class="card">
            <div class="card-header">
              <h5>Cuenta</h5>
            </div>
            <div class="card-body">
              <form id="MainForm">
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-floating mb-3">
                      <input type="text" class="form-control" id="fnameInp" placeholder="Nombre">
                      <label for="floatingInput">Nombre</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating mb-3">
                      <input type="text" class="form-control" id="lnameInp" placeholder="Apellido">
                      <label for="floatingInput1">Apellido</label>
                    </div>
                  </div>
                </div>
                <div class="form-floating mb-3">
                  <input type="email" class="form-control" id="emailInp" placeholder="Correo Electrónico">
                  <label for="floatingInput2">Correo Electrónico</label>
                </div>
                <div class="form-floating mb-3">
                  <select class="form-select" id="roleSelect" aria-label="Floating label select example">
                    <option selected>Elige una función</option>
                    <option value="Asistente">Asistente</option>
                    <option value="Administrador">Administrador</option>
                    <option value="Administrador Web">Administrador Web</option>
                    <option value="Administrador de Almacén">Administrador de Almacén</option>
                  </select>
                  <label for="roleSelect">Función</label>
                </div>
                <div class="d-grid mt-4">
                  <button type="submit" class="btn btn-dark-blue" id="updateButton">Actualizar
                    datos</button>
                </div>
              </form>

            </div>
          </div>
        </div>

      </div>

    </div>
  </div>

  <footer class="pc-footer">
    <div class="footer-wrapper container-fluid">
      <div class="row">
        <div class="col-sm-6 my-1">
          <p class="m-0">By: Luz Collado<a target="_blank"></a></p>
        </div>
      </div>
    </div>
  </footer>

  <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";
    import { getDatabase, set, ref, get, child, update } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyACeBjm2kFwGO9OeNJNMJ8pQizNtVzV7Dg",
      authDomain: "the-smoke-spaceship.firebaseapp.com",
      projectId: "the-smoke-spaceship",
      storageBucket: "the-smoke-spaceship.appspot.com",
      messagingSenderId: "395109733647",
      appId: "1:395109733647:web:ca11be9cd1fe4114e65a7a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const auth = getAuth();

    const usernameElement = document.getElementById('username');
    const roleElement = document.getElementById('role');
    const registerButton = document.getElementById('registerButton');
    const settingsButton = document.getElementById('settingsButton');

    function showUserData(userId) {
      const dbRef = ref(db);
      get(child(dbRef, `UsersAuthList/${userId}`)).then((snapshot) => {
        if (snapshot.exists()) {
          const userData = snapshot.val();
          usernameElement.textContent = `${userData.firstname} ${userData.lastname}`;
          roleElement.textContent = userData.roleselect;

          if (userData.roleselect === 'Asistente') {
            registerButton.disabled = true;
            document.getElementById('empleados').addEventListener('click', function (event) {
              event.preventDefault();
            });
          }
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      });
    }

    function showUserData2(userId) {
      const dbRef = ref(db);
      get(child(dbRef, `UsersAuthList/${userId}`)).then((snapshot) => {
        if (snapshot.exists()) {
          const userData = snapshot.val();
          usernameElement.textContent = `${userData.firstname} ${userData.lastname}`;
          roleElement.textContent = userData.roleselect;

          if (userData.roleselect === 'Administrador de Almacén') {
            registerButton.disabled = true;
            document.getElementById('empleados').addEventListener('click', function (event) {
              event.preventDefault();
            });
          }
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      });
    }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        showUserData(user.uid);
        showUserData2(user.uid);
      } else {
        console.log("User is not signed in");
      }
    });

    let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
    let UserInfo = JSON.parse(sessionStorage.getItem("user-info"));
    let UserName = JSON.parse(sessionStorage.getItem("username"));
    let Role = JSON.parse(sessionStorage.getItem("role"));
    let MainForm = document.getElementById('MainForm');

    let SignoutBtn = document.getElementById('signoutbutton');

    let Signout = () => {
      sessionStorage.removeItem("user-creds");
      sessionStorage.removeItem("user-info");

      window.location.href = 'login';
    }

    let CheckCred = () => {
      if (!sessionStorage.getItem("user-creds"))
        window.location.href = 'login';
      else {
        UserName.innerText = ` ${UserName.firstname}`
        Role.innerText = ` ${UserName.roleselect}`
      }
    }

    document.getElementById('registerButton').addEventListener('click', () => {
      window.location.href = 'register';
    });

    document.getElementById('settingsButton').addEventListener('click', () => {
      window.location.href = 'settings';
    });

    window.addEventListener('DOMContentLoaded', () => {
      const userCreds = sessionStorage.getItem("user-creds");

      if (userCreds) {
        const userCredsObj = JSON.parse(userCreds);
        const userId = userCredsObj.uid;
        populateUserData(userId);
        populateUserData2(userId);

      }
    });

    function populateUserData(userId) {
      const dbRef = ref(getDatabase());
      get(child(dbRef, `UsersAuthList/${userId}`)).then((snapshot) => {
        if (snapshot.exists()) {
          const userData = snapshot.val();

          document.getElementById('fnameInp').value = userData.firstname;
          document.getElementById('lnameInp').value = userData.lastname;
          document.getElementById('emailInp').value = userData.email;
          document.getElementById('roleSelect').value = userData.roleselect;


          if (userData.roleselect === 'Administrador de Almacén') {
            document.getElementById('fnameInp').disabled = true;
            document.getElementById('lnameInp').disabled = true;
            document.getElementById('emailInp').disabled = true;
            document.getElementById('roleSelect').disabled = true;
            document.getElementById('updateButton').disabled = true;
          }
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      });
    }

    function populateUserData2(userId) {
      const dbRef = ref(getDatabase());
      get(child(dbRef, `UsersAuthList/${userId}`)).then((snapshot) => {
        if (snapshot.exists()) {
          const userData = snapshot.val();

          document.getElementById('fnameInp').value = userData.firstname;
          document.getElementById('lnameInp').value = userData.lastname;
          document.getElementById('emailInp').value = userData.email;
          document.getElementById('roleSelect').value = userData.roleselect;


          if (userData.roleselect === 'Asistente') {
            document.getElementById('fnameInp').disabled = true;
            document.getElementById('lnameInp').disabled = true;
            document.getElementById('emailInp').disabled = true;
            document.getElementById('roleSelect').disabled = true;
            document.getElementById('updateButton').disabled = true;
          }
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      });
    }

    function updateUserData(event) {
      event.preventDefault();


      const firstName = document.getElementById('fnameInp').value;
      const lastName = document.getElementById('lnameInp').value;
      const email = document.getElementById('emailInp').value;
      const roleSelect = document.getElementById('roleSelect').value;


      const userCreds = sessionStorage.getItem("user-creds");
      if (!userCreds) {
        console.log("User credentials not found");
        return;
      }
      const userId = JSON.parse(userCreds).uid;


      const userDataToUpdate = {
        firstname: firstName,
        lastname: lastName,
        email: email,
        roleselect: roleSelect
      };

      update(ref(db, `UsersAuthList/${userId}`), userDataToUpdate)
        .then(() => {
          console.log("User data updated successfully");
        })
        .catch((error) => {
          console.error("Error updating user data: ", error);
        });

    }

    MainForm.addEventListener('submit', updateUserData);
    SignoutBtn.addEventListener('click', Signout);


  </script>

  <script src="popper.min.js"></script>
  <script src="simplebar.min.js"></script>
  <script src="bootstrap.min.js"></script>
  <script src="custom-font.js"></script>
  <script src="pcoded.js"></script>
  <script src="feather.min.js"></script>





  <script>layout_change('light');</script>




  <script>font_change("Roboto");</script>


  <script>change_box_container('false');</script>


  <script>layout_caption_change('true');</script>




  <script>layout_rtl_change('false');</script>


  <script>preset_change("preset-1");</script>


</body>
<!-- [Body] end -->

</html>